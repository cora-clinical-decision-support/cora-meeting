<!doctype html>
<!--
  Material Design Lite
  Copyright 2015 Google Inc. All rights reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License
-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CORA for Hospital A</title>
    <meta name="description" content="CORA Interface (testing) for Multidisciplinary LVAD Decision Meeting. Copyright: Carnegie Mellon University.">
    <meta name="author" content="Qian Yang (qyang1 at cs dot cmu dot edu)">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/favicon.png">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <!-- Import Fonts & Icons -->
    <link rel="shortcut icon" href="images/favicon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!--Import material deisng css-->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_purple-pink.min.css">
    <link rel="stylesheet" href="css/styles.css">

    <style>
        #view-source {
            position: fixed;
            display: block;
            right: 0;
            bottom: 0;
            margin-right: 40px;
            margin-bottom: 40px;
            z-index: 900;
        }

    </style>

    <!-- CSS for MetricsGraphics -->
    <link href='css/metricsgraphics.css' rel='stylesheet' type='text/css'>

    <!-- popups -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>

    <script src='js/modal.js'></script>

    <!-- JS for D3 -->
    <script src='js/highlight.pack.js'></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="js/popup.js"></script>
    <link rel="stylesheet" href="css/popup.css">

    <!-- MetricsGraphics -->
    <script src='js/MG.js'></script>
    <script src='js/misc/utility.js'></script>
    <script src='js/common/data_graphic.js'></script>
    <script src='js/common/hooks.js'></script>
    <script src='js/common/register.js'></script>
    <script src='js/common/bootstrap_tooltip_popover.js'></script>
    <script src='js/common/scales.js'></script>
    <script src='js/common/chart_title.js'></script>
    <script src='js/common/y_axis.js'></script>
    <script src='js/common/x_axis.js'></script>
    <script src='js/common/scales.js'></script>
    <script src='js/common/init.js'></script>
    <script src='js/common/markers.js'></script>
    <script src='js/common/rollover.js'></script>
    <script src='js/common/window_listeners.js'></script>
    <script src='js/layout/bootstrap_dropdown.js'></script>
    <script src='js/layout/button.js'></script>
    <script src='js/charts/line.js'></script>
    <script src='js/charts/histogram.js'></script>
    <script src='js/charts/point.js'></script>
    <script src='js/charts/bar.js'></script>
    <script src='js/charts/table.js'></script>
    <script src='js/charts/missing.js'></script>
    <script src='js/misc/process.js'></script>
    <script src='js/misc/smoothers.js'></script>
    <script src='js/misc/formatters.js'></script>
    <script src='js/misc/transitions.js'></script>
    <script src='js/misc/error.js'></script>

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/prism.js"></script>

    <!-- JS for timeline brushing -->
    <script src='js/mg_line_brushing.js'></script>
    <script src='js/mg_regions.js'></script>
    <link rel='stylesheet' href='css/mg_line_brushing.css' />

</head>

<body>

    <div class="mdl-layout mdl-js-layout mdl-layout__fixed_drawer">

        <!-- Drawer: Patient List -->
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Adams, John</span>
            <nav class="mdl-navigation">
                <a class="mdl-navigation__link" href="">Patient #2</a>
                <a class="mdl-navigation__link" href="">Patient #3</a>
                <a class="mdl-navigation__link" href="">Patient #4</a>
            </nav>
        </div>


        <main class="mdl-layout__content">
            <div class="page-content mdl-grid clearfix">

                <div class="mdl-cell mdl-cell--3-col">

                    <!-- Patient Basic Info -->
                    <div class="mdl-card">
                        <!-- Demographic -->
                        <div class="mdl-card__title ">
                            <h1 class="mdl-card__title-text ">John, Adams</h1>
                        </div>
                        <div class="mdl-card__supporting-text ">
                            Date of Presentation: 03/22/2017
                        </div>
                        <div class="pt-brief-bar ">
                            <ul class="pt-brief-list ">
                                <li class="pt-brief-item ">73M</li>
                                <li class="pt-brief-item ">AA</li>
                                <li class="pt-brief-item ">AB+</li>
                                <li class="pt-brief-item ">BMI 29.4</li>
                                <li class="pt-brief-item ">OUT-PT</li>
                            </ul>
                        </div>

                        <!-- Key Medical Condition -->
                        <div class="pt-brief-item summary">
                            Prm Dx
                        </div>
                        <div class="mdl-chip ">
                            <h3 class="mdl-chip__text min-width expandDx waves-effect waves-light btn">Ischemic</h3>
                            <div id="expandDx" class="modal">
                                <div class="modal-content">
                                    <div class="pt-brief-bar">
                                        <p class="section-header">Primary Diagnosis</p>
                                    </div>
                                    <ul>
                                        <li>
                                            <h7>2012</h7> First Dx.</li>
                                        <li>
                                            <h7>02/2012</h7> First MI, DES to LCX.</li>
                                        <li>
                                            <h7>03/2012</h7> TTE, LVEF 15%, LVEDD 58 mm.</li>
                                        <li>
                                            <h7>06/2012</h7> TTE, LVEF 30%, LVEDD 62 mm.</li>
                                        <li>
                                            <h7>03/2013</h7> Abnormal stress test, referred for CABG.</li>
                                        <li>
                                            <h7>11/2016</h7> TTE, LVEF 10-20%, LVEDD 68 mm. Stress VO2.</li>
                                        <li>
                                            <h7>02/2017</h7> pVO2 12, RER 1.1.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="pt-brief-item summary">Major Comorbidities</div>
                        <div class="mdl-chip ">
                            <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">Diabetes Type II</h3>
                        </div>
                        <div class="mdl-chip ">
                            <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">Hist. of Prostate Cancer</h3>
                        </div>
                        <div class="mdl-chip ">
                            <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">VT</h3>
                        </div>
                        <div class="mdl-chip ">
                            <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">CKD Stage III</h3>
                        </div>

                        <div class="pt-brief-item summary" style="margin-top:15px">
                            Indication
                            <div class="mdl-chip half-chip">
                                <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">DT LVAD</h3>
                            </div>
                        </div>

                        <div class="pt-brief-item summary">
                            Projection
                            <div class="mdl-chip half-chip">
                                <h3 class="mdl-chip__text min-width expandCmbdt waves-effect waves-light btn">56% 1yr Survival</h3>
                            </div>
                        </div>

                        <div id="expandCmbdt" class="modal">
                            <div class="modal-content">
                                <div class="pt-brief-bar">
                                    <p class="section-header">Major Comorbidities</p>
                                </div>
                                <ul style="padding-left: 10px">
                                    <li><b>Diabetes mellitus type 2:</b> NIDDM, Dx 2001, mild peripheral neuropathy and CKD stage III;</li>
                                    <li><b>History of Prosetic Cancer:</b> CABG 03/2013 - LIMA to LAD, SVG to OM and RCA;</li>
                                    <li><b>Ventricular Tachycardia:</b> ICD shocks for monomorphic VT 11/2016, started on Amiodarone;</li>

                                    <li><b>CKD stage III:</b> Dx 2016, likely related to DM and cardio renal syndrome; eGFR 50</li>

                                    <li><b>Pulmonary hypertension from left heart disease:</b> DX 7/2015: RA 12, PA 61/36 (47), W31 TTE 02/2017 â€“ est. PASP 60 mm Hg.</li>
                                </ul>
                            </div>

                        </div>

                        <div class="pt-brief-item summary">
                            Transplant
                            <div class="mdl-chip half-chip">
                                <h3 class="mdl-chip__text min-width ">Ineligible</h3>
                            </div>
                        </div>


                        <div class="pt-brief-item summary">
                            Psycho-social
                            <div class="mdl-chip half-chip">
                                <h3 class="mdl-chip__text min-width">Approved</h3>
                            </div>
                        </div>


                        <div class="pt-brief-item summary">
                            Insurance
                            <div class="mdl-chip half-chip">
                                <h3 class="mdl-chip__text min-width expandInsurance waves-effect waves-light btn">Medicare</h3>
                                <div id="expandInsurance" class="modal">
                                    <div class="modal-content">
                                        <div class="pt-brief-bar">
                                            <p class="section-header">Insurance</p>
                                        </div>
                                        <p><b>Has patient met with a transplant financial coordinator to review financial capabilities and resources? </b>Yes.</p>
                                        <p><b>Insurance Comments: </b>Voiced no concerns</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="mdl-cell mdl-cell--9-col">


                    <div class="mdl-grid mdl-grid--no-spacing">
                        <div class="mdl-card mdl-cell mdl-cell--9-col">

                            <!-- Timeline Chart -->
                            <div class="mdl-card full-width">
                                <div class="pt-brief-bar" style="margin-bottom:0">
                                    <p class="section-header ">HISTORY</p>
                                </div>

                                <div class="full-width squeeze " id="timeline-chart"></div>

                                <div class="projection-intervention">
                                    <p class="time-line-legend"></p>
                                    <button class="mdl-button mdl-js-button mdl-button--raised" data-y_accessor="vad" data-y_upper="vad_upper" id="default-projection-intervention" data-y_lower="vad_lower ">VAD</button>

                                    <button class="mdl-button mdl-js-button mdl-button--raised" data-y_accessor="med" data-y_upper="med_upper" data-y_lower="med_lower">Medication</button>
                                </div>
                            </div>

                        </div>

                        <div class="mdl-card mdl-cell mdl-cell--3-col">
                            <div class="mdl-card full-width">
                                <div class="pt-brief-bar" style="margin-bottom:0">
                                    <p class="section-header ">PROJECTION</p>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="mdl-grid mdl-grid--no-spacing">
                        <div class="mdl-card mdl-cell mdl-cell--3-col">
                            <!-- popup start -->
                            <div id="overlay"></div>

                            <div class="mdl-card">
                                <div class="pt-brief-bar">
                                    <p class="section-header ">LABS</p>
                                </div>

                                <div>
                                    <table class="data-table mdl-js-data-table">
                                        <tbody>
                                            <tr>
                                                <td>HGB</td>
                                                <td>9.7</td>
                                            </tr>
                                            <tr>
                                                <td>WBC</td>
                                                <td>4.44</td>
                                            </tr>
                                            <tr>
                                                <td>PLT</td>
                                                <td>193</td>
                                            </tr>
                                            <tr>
                                                <td>CREAT</td>
                                                <td>1.7</td>
                                            </tr>
                                            <tr>
                                                <td>HGBA1C</td>
                                                <td>7.2</td>
                                            </tr>
                                            <tr>
                                                <td>SGPT</td>
                                                <td>12</td>
                                            </tr>
                                            <tr>
                                                <td>SGOT</td>
                                                <td>23</td>
                                            </tr>
                                            <tr>
                                                <td>ALB</td>
                                                <td>3.4</td>
                                            </tr>
                                            <tr>
                                                <td>PALB</td>
                                                <td>16.0</td>
                                            </tr>
                                            <tr>
                                                <td>NA</td>
                                                <td>121</td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td>
                                                    <!-- Modal Trigger -->
                                                    <h7 class="expandLabs waves-effect waves-light btn">more...</h7>


                                                    <!-- Modal Structure -->
                                                    <div id="expandLabs" class="modal">
                                                        <div class="modal-content">
                                                            <div class="pt-brief-bar">
                                                                <p class="section-header">LABS</p>
                                                            </div>
                                                            <p>CABG 03/2013 - LIMA to LAD, SVG to OM and RCA</p>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>

                        <div class="mdl-card mdl-cell mdl-cell--3-col">
                            <div class="pt-brief-bar">
                                <div class="section-header">CARDCATH</div>
                                <div class="appended-detail">02/2017</div>
                            </div>
                            <table class="data-table mdl-js-data-table">
                                <tbody>
                                    <tr class="first-row">
                                        <td>RA</td>
                                        <td>12</td>
                                    </tr>
                                    <tr>
                                        <td>PAP</td>
                                        <td>73/34(51)</td>
                                    </tr>
                                    <tr>
                                        <td>PCWP</td>
                                        <td>33</td>
                                    </tr>
                                    <tr>
                                        <td>TPG</td>
                                        <td>18</td>
                                    </tr>
                                    <tr>
                                        <td>SVR</td>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>CI</td>
                                        <td>2.18</td>
                                    </tr>
                                    <tr>
                                        <td>SVO2</td>
                                        <td>42</td>
                                    </tr>
                                    <tr>
                                        <td>PVR</td>
                                        <td>305</td>
                                    </tr>
                                    <tr>
                                        <td>Peak VO2</td>
                                        <td>12</td>
                                    </tr>
                                    <tr>
                                        <td>RER</td>
                                        <td>1.1</td>
                                    </tr>
                                    <tr>
                                        <td>6MWD</td>
                                        <td>240m</td>
                                    </tr>
                                    <tr>
                                        <td>Last LHC</td>
                                        <td>02/16/2017</td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <!-- Modal Trigger -->
                                            <h7 class="expandCardcath waves-effect waves-light btn">more...</h7>


                                            <!-- Modal Structure -->
                                            <div id="expandCardcath" class="modal">
                                                <div class="modal-content">
                                                    <div class="pt-brief-bar">
                                                        <p class="section-header">CARDCATH</p>
                                                    </div>
                                                    <p><b>Last LHC:</b>
                                                        <h7>02/2016</h7> LIMA to LAD patent, occluded SVD to OM and RCA, LM. Severe diffuse disease mid to distal LAD, LCX and RCA - severely disease (chronically occluded).</p>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="mdl-card mdl-cell mdl-cell--3-col">
                            <div class="mdl-card">
                                <div class="pt-brief-bar">
                                    <div class="section-header">Cardiac Meds</div>
                                </div>
                                <table class="data-table mdl-js-data-table">
                                    <tbody>
                                        <tr class="first-row">
                                            <td>ASA</td>
                                            <td>81 mg</td>
                                        </tr>
                                        <tr>
                                            <td>Plavix</td>
                                            <td>75 mg</td>
                                        </tr>
                                        <tr>
                                            <td>Lisinopril</td>
                                            <td>5 mg/day</td>
                                        </tr>
                                        <tr>
                                            <td>Amiodarone</td>
                                            <td>400 mg/day</td>
                                        </tr>
                                        <tr>
                                            <td>Aldactone</td>
                                            <td>25 /day</td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                            <div class="mdl-card">
                                <div class="pt-brief-bar">
                                    <div class="section-header">ECHO</div>
                                    <div class="appended-detail">02/2017</div>
                                </div>
                                <div>
                                    <table class="data-table squeeze mdl-js-data-table ">
                                        <tbody>
                                            <tr>
                                                <td>LVEDD</td>
                                                <td>8.3</td>
                                            </tr>
                                            <tr>
                                                <td>LVEF</td>
                                                <td>14%</td>
                                            </tr>
                                            <tr>
                                                <td>RV Func</td>
                                                <td>Moderate</td>
                                            </tr>
                                            <tr>
                                                <td>PASP</td>
                                                <td>60</td>
                                            </tr>
                                            <tr>
                                                <td>MR</td>
                                                <td>Moderate Severe</td>
                                            </tr>
                                            <tr>
                                                <td>TR</td>
                                                <td>Moderate</td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td>
                                                    <!-- Modal Trigger -->
                                                    <h7 class="expandEcho waves-effect waves-light btn">more...</h7>


                                                    <!-- Modal Structure -->
                                                    <div id="expandEcho" class="modal">
                                                        <div class="modal-content">
                                                            <div class="pt-brief-bar">
                                                                <p class="section-header">ECHO</p>
                                                            </div>
                                                            <ul>
                                                                <li><b>Left Ventricle: </b>Left ventricle is severely dilated. The left ventricular systolic function is severely decreased. The left ventricular ejection fraction is 15 - 19% (normal LVEF is 55%-74%). There is Left ventricular global hypokinesis present. Left ventricular diastolic dysfunction is present, consistent with restrictive physiology (Grade III). Left atrial pressure is elevated.</li>
                                                                <li><b>Left Atrium:</b> The left atrium is moderately dilated. Interatrial Septum - The interatrial septum appears normal.</li>
                                                                <li><b>Right Ventricle: </b>The right ventricle is severely dilated. The right ventricle has a mildly to moderately reduced systolic function. There is a pacemaker or ICD lead present in the right ventricle.</li>
                                                                <li><b>Right Atrium:</b> The right atrium is dilated. Aorta - Normal aortic root, size and contour. Aortic Valve - The aortic valve has normal trileaflet morphology, no stenosis and no regurgitation. Mitral Valve - The mitral valve leaflets have focal calcification. There is moderate (2-3+) mitral regurgitation. The jet is eccentric and posteriorly-directed.</li>
                                                                <li><b>Tricuspid Valve:</b> The tricuspid valve has normal leaflet thickness. There is no significant stenosis of the tricuspid valve present. There is mild to moderate (1-2+) tricuspid valve regurgitation present. Pulmonic Valve - There is normal pulmonic valve leaflet thickness. There is no pulmonic stenosis present. There is trace pulmonic valve regurgitation.</li>
                                                                <li><b>IVC/SVC: </b>Using inferior vena cava size and collapsibility, there is indeterminate right atrial pressure (8mmHg).</li>
                                                                <li><b>Pulmonary Artery: </b>The right ventricular systolic pressure is 43 mm Hg. Mild (40-49 mm Hg) pulmonary hypertension is present.</li>
                                                                <li><b>Pericardium: </b>A pericardial effusion is not present.</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>

                                        </tbody>
                                    </table>

                                </div>


                            </div>
                        </div>

                        <div class="mdl-card mdl-cell mdl-cell--3-col">
                            <div class="mdl-card">
                                <div class="pt-brief-bar">
                                    <div class="section-header">PFT</div>
                                    <div class="appended-detail ">02/2017</div>
                                </div>
                                <table class="data-table mdl-js-data-table">
                                    <tbody>
                                        <tr class="first-row">
                                            <td>FEV1</td>
                                            <td>2.16</td>
                                        </tr>
                                        <tr>
                                            <td>DLCO</td>
                                            <td>58</td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td>
                                                <!-- Modal Trigger -->
                                                <h7 class="expandPFT waves-effect waves-light btn">more...</h7>


                                                <!-- Modal Structure -->
                                                <div id="expandPFT" class="modal">
                                                    <div class="modal-content">
                                                        <div class="pt-brief-bar">
                                                            <p class="section-header">PFT</p>
                                                        </div>
                                                        <p><b>Quality of Data:</b> The patient's efforts are acceptable and reproducible.
                                                            <br><b>Test Performed:</b> Complete pulmonary function tests, including spirometry with and without bronchodilator, measurement of lung volume, and diffusing capacity.
                                                            <br><b>Spirometry Interpretation:</b> FEV1/FVC ratio is 66% predicted. FEV1 is 85% predicted. No significant bronchodilator response. FVC is 90% predicted.
                                                            <br><b>Flow Volume Loops:</b> Flow-Volume loops are normal.
                                                            <br><b>Lung Volumes:</b> Plethysmographic lung volumes are within normal limits.
                                                            <br><b>Diffusing Capacity:</b> Diffusing capacity of the lung is reduced at 58 % predicted.
                                                            <br><b>Conclusions:</b> Mild obstructive lung defect with FEV1 of 85%. No restriction noted. No bronchodilator response. Moderate decrease in diffusion capacity.</p>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mdl-card">
                                <div class="pt-brief-bar">
                                    <div class="section-header">EKG</div>
                                    <div class="appended-detail ">02/2017</div>
                                </div>
                                <table class="data-table mdl-js-data-table">
                                    <tbody>
                                        <tr class="first-row">

                                            <td>QRS</td>
                                            <td>128</td>
                                        </tr>
                                        <tr>
                                            <td>Rhythm</td>
                                            <td>A fib</td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td>
                                                <!-- Modal Trigger -->
                                                <h7 class="expandEKG waves-effect waves-light btn">more...</h7>

                                                <!-- Modal Structure -->
                                                <div id="expandEKG" class="modal">
                                                    <div class="modal-content">
                                                        <div class="pt-brief-bar">
                                                            <p class="section-header">EKG</p>
                                                        </div>
                                                        <p></p>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </main>

    </div>



    <script src="https://code.getmdl.io/1.3.0/material.min.js "></script>
    <script>
        d3.json('data/bp.json', function(data) {

            // handling multiple lines
            for (var i = 0; i < data.length; i++) {
                data[i] = MG.convert.date(data[i], 'date');
            }

            // add Singleton
            var data_singleton = [{
                'date': new Date('2015-03-05T21:00:00Z'),
                'value': 100
            }];


            // handling different sized lines
            var all_the_data = MG.clone(data[0]);
            for (i = 1; i < data.length; i++) {
                for (var j = 0; j < data[i].length; j++) {
                    if (i === 2 && all_the_data[j].date < new Date('2014-02-01')) {} else {
                        all_the_data[j]['value' + (i + 1)] = data[i][j].value;
                    }
                }
            }

            // add milestones
            var clicker = function() {
                window.open('https://www.google.com', '_blank');
            };

            var markers = [{
                'date': new Date('2013-06-01T00:00:00.000Z'),
                'label': "STEMI "
            }, {
                'date': new Date('2014-01-01T00:00:00.000Z'),
                'label': "HFrEF Dx "
            }, {
                'date': new Date('2014-05-01T00:00:00.000Z'),
                'label': "CABG",
                'click': clicker
            }, {
                'date': new Date('2015-06-01T00:00:00.000Z'),
                'label': "NYHA ClassII"
            }, {
                'date': new Date('2016-11-01T00:00:00.000Z'),
                'label': "NYHA ClassIII"
            }, {
                'date': new Date('2017-02-01T00:00:00.000Z'),
                'label': "Add Inotrope; Referred for MCS. "
            }];

            var hospitalizations = [{
                date: [new Date('2014-01-01T00:00:00.000Z'), new Date('2014-01-07T00:00:00.000Z')],
                label: '#1', //optional
                class: 'mg-regions' //optional
            }, {
                date: [new Date('2016-03-01T00:00:00.000Z'), new Date('2016-03-10T00:00:00.000Z')],
                label: '#2', //optional
                class: 'mg-regions' //optional
            }, {
                date: [new Date('2016-06-14T00:00:00.000Z'), new Date('2016-06-26T00:00:00.000Z')],
                label: '#3', //optional
                class: 'mg-regions' //optional
            }, {
                date: [new Date('2016-08-14T00:00:00.000Z'), new Date('2016-08-29T00:00:00.000Z')],
                label: '#4', //optional
                class: 'mg-regions' //optional
            }, {
                date: [new Date('2017-02-25T00:00:00.000Z'), new Date('2017-03-01T00:00:00.000Z')],
                label: '#5', //optional
                class: 'mg-regions' //optional
            }]

            var vad_hspt_prediction = [{
                date: [new Date('2018-01-01T00:00:00.000Z'), new Date('2018-01-03T00:00:00.000Z')],
                label: 'vad#1', //optional
                class: 'mg-regions' //optional
            }]

            // handling multiple intervention choices
            var globals = {};
            var default_chart = {
                data: data,
                animate_on_load: true,
                top: 50,
                left: 10,
                right: 10,
                full_width: true,
                height: 200,
                target: '#timeline-chart',

                x_rug: true,
                x_accessor: 'date',
                show_secondary_x_label: true,
                max_x: new Date('2019-03-01T00:00:00.000Z'),
                min_x: new Date('2013-05-01T00:00:00.000Z'),
                x_extended_ticks: false,
                y_accessor: 'value',
                y_axis: true,
                y_label: 'BP',
                max_y: 170,
                min_y: 70,
                color: ['#000000', '#b0bec5'],


                x_mouseover: function(d) {
                    var this_date = new Date()
                    var today = new Date('2017-03-01T00:00:00.000Z')
                    Object.keys(d).forEach(
                        function(key) {
                            this_date = d["key"]
                        }
                    )

                    var date_diff = (Math.round((today - this_date) / (1000 * 60 * 60 * 24)))
                    var temp = (date_diff >= 0) ? date_diff + ' days ago' : Math.abs(date_diff) + ' days later'
                    return temp
                },

                show_confidence_band: ['lower', 'upper'],
                markers: markers,
                regions: hospitalizations,
                baselines: [{
                    value: 90,
                    label: 'BP90'
                }],

                legend: ['BP History', 'Prognostic Projection'],
                legend_target: '.time-line-legend',

            };

            // load data and draw chart
            d3.json('data/bp.json', function(data) {
                data = MG.convert.date(data, 'date');
                globals.data = data;

                default_chart.data = data;
                MG.data_graphic(default_chart);
            });

            // redraw upon button click
            $('.projection-intervention button').click(function() {
                var new_y_accessor = $(this).data('y_accessor');
                var new_y_upper = $(this).data('y_upper');
                var new_y_lower = $(this).data('y_lower');
                console.log(new_y_accessor);
                console.log(hospitalizations);

                default_chart.y_accessor = ['value', new_y_accessor];
                default_chart.show_confidence_band = [new_y_upper, new_y_lower];

                default_chart.regions = hospitalizations;
                // change button state
                $(this).addClass('active mdl-button--colored').siblings().removeClass('active mdl-button--colored');

                // update data
                delete default_chart.xax_format;
                MG.data_graphic(default_chart);
            });

        });

    </script>

    <script>
        // load vad timeline chart on load
        $(function() {
            $('#default-projection-intervention').click();
        });

    </script>

    <script>
        $(document).ready(function() {
            $("h3.expandDx").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandDx"
                });
            });

            $("h3.expandCmbdt").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandCmbdt"
                });
            });

            $("h3.expandInsurance").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandInsurance"
                });
            });


            $("h7.expandLabs").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandLabs"
                });
            });

            $("h7.expandEcho").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandEcho"
                });
            });

            $("h7.expandCardcath").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandCardcath"
                });
            });

            $("h7.expandPFT").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandPFT"
                });
            });

            $("h7.expandEKG").on("click", function(e) {
                e.preventDefault();
                $(this).simplePopup({
                    type: "html",
                    htmlSelector: "#expandEKG"
                });
            });


        });

    </script>



</body>

</html>
